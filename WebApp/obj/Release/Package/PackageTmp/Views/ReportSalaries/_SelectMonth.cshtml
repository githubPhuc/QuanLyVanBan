@{
    var username = ViewData["username"];
    var token = ViewData["token"];
}
<style>
    .flex-container {
        margin-top: 20px;
        display: flex;
        flex-wrap: wrap;
    }

    .list-group-item {
        flex: 0 0 calc(100% / 6);
        border-top: 1px solid #dfdfdf;
        padding-top:10px;
        font-weight: 600;
        position: relative;
    }
    .list-group-item + .list-group-item {
            border-top-width:1px;
     }
    .list-group-item:hover {
            background-color: #aaa;
            cursor: pointer
     }
     .list-group-item:first-child {
           border-top: 1px solid #dfdfdf
     }
/*     .line {
            border-bottom: 1px solid red;
            border-width: 10px;
    }*/
</style>
<div class="row">
        <div class="months d-flex flex-wrap">

        </div>

</div>
<div class="row mt-5">
    <b class="ml-2"> File đã chọn <i class="fa-solid fa-file-excel" style="color: #159d0b;"></i> :</b>
    <span id="fileName" class="ml-3"></span>
    <input style="display:none" id="date" class="ml-3" value="" />
    <input style="display:none" id="Username" class="ml-3" value="@username" />
    <input style="display:none" id="token" class="ml-3" value="@token" />
</div>
<script>
    //Create Months

    updateMonths(2024)
    function updateMonths(year) {
        console.log(year)

        const monthsArray = [
            "01",
            "02",
            "03",
            "04",
            "05",
            "06",
            "07",
            "08",
            "09",
            "10",
            "11",
            "12",
        ];
        const numberOfMonths = monthsArray.length;
        const months = monthsArray.slice(0, numberOfMonths);
        const monthsContainer = document.querySelector(".months");
        monthsContainer.innerHTML = "";
        console.log(year)
        const currentDate = new Date();
        const currentMonth = currentDate.getMonth() + 1;
        const currentYear = currentDate.getFullYear();
        const monthsAndYears = [];
        months.forEach((month, index) => {
            console.log(month)
            var i = index + 1
            const isCurrentMonth = i === currentMonth && year === currentYear;
            const isFutureMonth = year > currentYear || (year === currentYear && i > currentMonth);
            const div = document.createElement("div");
            div.classList.add("list-group-item", "line");
            if (isCurrentMonth) {
                div.classList.add("bg-red");
            }

            if (isFutureMonth) {
                div.addEventListener("click", CantUpload);
            } else {
                div.addEventListener("click", function () {
                    triggerFileInput(i);
                });
            }
            div.innerHTML = `
            Tháng ${month}
            <input style="display:none" type="text" id="thang_${i}" name="thang" value="${year +"-"+month}" />
            <input type="file" id="importSalaries_${i}" style="display:none" accept=".xlsx" onchange="openFile(event, ${i})" />
        `;
            monthsContainer.appendChild(div);
            monthsAndYears.push({ month: i, year });
        });
    }
    function prevYear() {
        var currentYearElement = document.getElementById('myModalTitleSelectMonth');
        console.log(currentYearElement)
        var currentYearText = currentYearElement.innerText.trim();
        var yearMatch = currentYearText.match(/\d{4}/);
        if (yearMatch) {
            var year = parseInt(yearMatch[0]);
            currentYearElement.innerText = "Chọn năm (" + (year - 1) + ")";
            var newYear = year - 1;
            updateMonths(newYear);
        }
    }

    function nextYear() {
        var currentYearElement = document.getElementById('myModalTitleSelectMonth');
        var currentYearText = currentYearElement.innerText.trim();
        const currentDate = new Date()
        const currentYear = currentDate.getFullYear();
        var yearMatch = currentYearText.match(/\d{4}/);

        if (yearMatch) {
            var year = parseInt(yearMatch[0]);
            if (year < currentYear) {
                currentYearElement.innerText = "Chọn năm (" + (year + 1) + ")";
                var newYear = year + 1;
                updateMonths(newYear);
            }
            else {
                notify("Chỉ có thể chọn năm bằng với năm hiện tại")
            }
        }
    }
    function CantUpload() {
        notify("Không thể tải bản lương lớn hơn tháng hiện tại")
    }
</script>
<script>
    

    var myModalDemoSalaries = {
        $modal: $('#myModalDemoSalaries'),
        $myModalContent: $("#myModalContentDemoSalaries"),
        $myModalTitle: $("#myModalTitleDemoSalaries")
    }
    function triggerFileInput(index) {
        console.log(index)
        var fileInput = document.getElementById('importSalaries_' + index);
        fileInput.click();
    }
    var selectedFile;
    function openFile(event, i) {
        var thang = $('#thang_'+i).val();
        console.log(thang)
        var fileInput = event.target;
        selectedFile = event.target.files[0];
        console.log(selectedFile)
        var fileNameSpan = document.getElementById('fileName');
        var date = $('#date');
        fileNameSpan.textContent = fileInput.files[0].name;
        date.val(`${thang}`);
    }
    function importData() {
            if (selectedFile) {
            var Username = $('#Username').val();
            var date = $('#date').val();
            var token = $('#token').val();
            var formData = new FormData();
             formData.append('file', selectedFile);
             formData.append('Username', Username);
             formData.append('date', date);
                $.ajax({
                url: 'https://api.hoanglongsecurity.info/api/ReportSalaries/postReportSalaries',
                type: 'POST',
                data: formData,
                headers: {
                    'Authorization': 'Bearer ' + token
                    },
                processData: false,
                contentType: false,
                success: function (response) {
                    // Xử lý kết quả trả về từ API
                    console.log(response);
                    loadModal("Tháng", '@Url.Action("_DemoImportExcel")', myModalDemoSalaries, { Username: Username})
                },
                error: function (response) {
                        notify(response.responseJSON.message)
                }
                });
        } else {
            notify("Không có file nào được chọn.");
        }
    }

</script>
